<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automação & Controles - Sistema de Gestão de Suprimentos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="css/global-styles.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    
    <style>
        .automation-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .automation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .workflow-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .schedule-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .alert-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .automation-section {
            margin-bottom: 40px;
        }
        
        .section-header {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin-bottom: 25px;
        }
        
        .automation-status {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .workflow-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
        }
        
        .workflow-item.active {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .workflow-item.paused {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        
        .workflow-item.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .automation-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .automation-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #28a745;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .schedule-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .alert-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-left: 4px solid #dc3545;
        }
        
        .alert-item.warning {
            border-left-color: #ffc107;
        }
        
        .alert-item.info {
            border-left-color: #17a2b8;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-gear"></i> Automação & Controles
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="analytics.html">
                            <i class="bi bi-graph-up-arrow"></i> Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="predictions.html">
                            <i class="bi bi-crystal-ball"></i> Predições
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="visualizations.html">
                            <i class="bi bi-pie-chart"></i> Visualizações
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="automation.html">
                            <i class="bi bi-gear"></i> Automação
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5 pt-4">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1><i class="bi bi-gear"></i> Automação & Controles</h1>
                <p class="text-muted">Configure e monitore processos automatizados do sistema</p>
            </div>
        </div>

        <!-- System Status -->
        <div class="automation-status">
            <div class="row">
                <div class="col-md-3">
                    <div class="text-center">
                        <i class="bi bi-cpu text-success" style="font-size: 2rem;"></i>
                        <h5 class="mt-2">Sistema Ativo</h5>
                        <small class="text-muted">Todos os serviços funcionando</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <i class="bi bi-arrow-repeat text-primary" style="font-size: 2rem;"></i>
                        <h5 class="mt-2">5 Workflows</h5>
                        <small class="text-muted">Processos em execução</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <i class="bi bi-clock text-warning" style="font-size: 2rem;"></i>
                        <h5 class="mt-2">12 Agendamentos</h5>
                        <small class="text-muted">Tarefas programadas</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <i class="bi bi-bell text-info" style="font-size: 2rem;"></i>
                        <h5 class="mt-2">3 Alertas</h5>
                        <small class="text-muted">Notificações ativas</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Automation Tools -->
        <div class="automation-section">
            <div class="section-header">
                <h3>Ferramentas de Automação</h3>
                <p class="text-muted mb-0">Configure e gerencie processos automatizados</p>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card automation-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-arrow-repeat" style="font-size: 3rem;"></i>
                            <h5 class="card-title mt-3">Workflows Automáticos</h5>
                            <p class="card-text">Configure fluxos de trabalho automatizados</p>
                            <button class="btn btn-light" onclick="openWorkflowManager()">
                                <i class="bi bi-gear"></i> Gerenciar Workflows
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card automation-card workflow-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-clock" style="font-size: 3rem;"></i>
                            <h5 class="card-title mt-3">Agendamento de Tarefas</h5>
                            <p class="card-text">Programe execução automática de tarefas</p>
                            <button class="btn btn-light" onclick="openScheduler()">
                                <i class="bi bi-calendar-plus"></i> Agendar Tarefas
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card automation-card schedule-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-bell" style="font-size: 3rem;"></i>
                            <h5 class="card-title mt-3">Sistema de Alertas</h5>
                            <p class="card-text">Configure notificações e alertas automáticos</p>
                            <button class="btn btn-light" onclick="openAlertManager()">
                                <i class="bi bi-bell-fill"></i> Configurar Alertas
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card automation-card alert-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-robot" style="font-size: 3rem;"></i>
                            <h5 class="card-title mt-3">Automação Inteligente</h5>
                            <p class="card-text">IA para automação avançada de processos</p>
                            <button class="btn btn-light" onclick="openAIAutomation()">
                                <i class="bi bi-cpu"></i> Configurar IA
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Workflows -->
        <div class="automation-section">
            <div class="section-header">
                <h3>Workflows Ativos</h3>
                <p class="text-muted mb-0">Processos automatizados em execução</p>
            </div>
            
            <div id="workflowsList">
                <div class="workflow-item active">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Atualização Automática de Estoque</h6>
                            <small class="text-muted">Executa a cada 30 minutos</small>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <span class="badge bg-success">Ativo</span>
                            <label class="automation-toggle">
                                <input type="checkbox" checked onchange="toggleWorkflow('stock-update')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="workflow-item active">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Backup Automático de Dados</h6>
                            <small class="text-muted">Executa diariamente às 02:00</small>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <span class="badge bg-success">Ativo</span>
                            <label class="automation-toggle">
                                <input type="checkbox" checked onchange="toggleWorkflow('backup')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="workflow-item paused">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Relatório Semanal Automático</h6>
                            <small class="text-muted">Pausado para manutenção</small>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <span class="badge bg-warning">Pausado</span>
                            <label class="automation-toggle">
                                <input type="checkbox" onchange="toggleWorkflow('weekly-report')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="workflow-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Sincronização com Fornecedores</h6>
                            <small class="text-muted">Executa a cada 2 horas</small>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <span class="badge bg-secondary">Inativo</span>
                            <label class="automation-toggle">
                                <input type="checkbox" onchange="toggleWorkflow('supplier-sync')">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scheduled Tasks -->
        <div class="automation-section">
            <div class="section-header">
                <h3>Tarefas Agendadas</h3>
                <p class="text-muted mb-0">Próximas execuções programadas</p>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="schedule-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Limpeza de Logs</h6>
                                <small class="text-muted">Próxima execução: Hoje, 23:00</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="editSchedule('log-cleanup')">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="schedule-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Análise de Performance</h6>
                                <small class="text-muted">Próxima execução: Amanhã, 06:00</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="editSchedule('performance-analysis')">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="schedule-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Atualização de Preços</h6>
                                <small class="text-muted">Próxima execução: Segunda, 08:00</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="editSchedule('price-update')">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="schedule-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Backup Completo</h6>
                                <small class="text-muted">Próxima execução: Domingo, 01:00</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="editSchedule('full-backup')">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Alerts -->
        <div class="automation-section">
            <div class="section-header">
                <h3>Alertas Ativos</h3>
                <p class="text-muted mb-0">Notificações e alertas do sistema</p>
            </div>
            
            <div id="alertsList">
                <div class="alert-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Estoque Baixo Detectado</h6>
                            <small class="text-muted">3 produtos com estoque abaixo do mínimo</small>
                        </div>
                        <button class="btn btn-sm btn-outline-danger" onclick="dismissAlert('low-stock')">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                </div>
                
                <div class="alert-item warning">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Backup Pendente</h6>
                            <small class="text-muted">Último backup realizado há 25 horas</small>
                        </div>
                        <button class="btn btn-sm btn-outline-warning" onclick="dismissAlert('backup-pending')">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                </div>
                
                <div class="alert-item info">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">Atualização Disponível</h6>
                            <small class="text-muted">Nova versão do sistema disponível</small>
                        </div>
                        <button class="btn btn-sm btn-outline-info" onclick="dismissAlert('update-available')">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Processando...</span>
            </div>
            <p class="mt-2">Configurando automação...</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notificação</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Mensagem
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/global-functions.js"></script>
    <script src="js/mobile-menu.js"></script>
    
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateSystemStatus();
        });

        // Update system status
        function updateSystemStatus() {
            // Simulate real-time status updates
            setInterval(() => {
                // Update workflow status randomly
                const workflows = document.querySelectorAll('.workflow-item');
                workflows.forEach(workflow => {
                    if (Math.random() > 0.95) { // 5% chance to update
                        const badge = workflow.querySelector('.badge');
                        if (badge && badge.textContent === 'Ativo') {
                            // Simulate activity
                            workflow.style.backgroundColor = '#e3f2fd';
                            setTimeout(() => {
                                workflow.style.backgroundColor = '';
                            }, 1000);
                        }
                    }
                });
            }, 5000);
        }

        // Automation functions
        function openWorkflowManager() {
            showToast('Abrindo gerenciador de workflows...', 'info');
            
            setTimeout(() => {
                // Simulate opening workflow manager
                const newWorkflow = `
                    <div class="workflow-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Novo Workflow Criado</h6>
                                <small class="text-muted">Configurado para execução manual</small>
                            </div>
                            <div class="d-flex align-items-center gap-3">
                                <span class="badge bg-secondary">Inativo</span>
                                <label class="automation-toggle">
                                    <input type="checkbox" onchange="toggleWorkflow('new-workflow')">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('workflowsList').insertAdjacentHTML('beforeend', newWorkflow);
                showToast('Novo workflow adicionado!', 'success');
            }, 1500);
        }

        function openScheduler() {
            showToast('Abrindo agendador de tarefas...', 'info');
            
            setTimeout(() => {
                // Simulate adding new scheduled task
                const newTask = `
                    <div class="col-md-6">
                        <div class="schedule-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Nova Tarefa Agendada</h6>
                                    <small class="text-muted">Próxima execução: Configurar</small>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" onclick="editSchedule('new-task')">
                                    <i class="bi bi-pencil"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.querySelector('.automation-section:nth-child(4) .row').insertAdjacentHTML('beforeend', newTask);
                showToast('Nova tarefa agendada criada!', 'success');
            }, 1500);
        }

        function openAlertManager() {
            showToast('Configurando sistema de alertas...', 'info');
            
            setTimeout(() => {
                showToast('Sistema de alertas configurado!', 'success');
            }, 1500);
        }

        function openAIAutomation() {
            showToast('Inicializando automação inteligente...', 'info');
            
            setTimeout(() => {
                showToast('IA de automação ativada!', 'success');
            }, 2000);
        }

        function toggleWorkflow(workflowId) {
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            loadingSpinner.style.display = 'block';
            
            setTimeout(() => {
                loadingSpinner.style.display = 'none';
                
                // Find the workflow item and update its status
                const workflowItems = document.querySelectorAll('.workflow-item');
                workflowItems.forEach(item => {
                    const toggle = item.querySelector('input[type="checkbox"]');
                    if (toggle && toggle.getAttribute('onchange').includes(workflowId)) {
                        const badge = item.querySelector('.badge');
                        if (toggle.checked) {
                            badge.textContent = 'Ativo';
                            badge.className = 'badge bg-success';
                            item.className = 'workflow-item active';
                            showToast(`Workflow ${workflowId} ativado!`, 'success');
                        } else {
                            badge.textContent = 'Inativo';
                            badge.className = 'badge bg-secondary';
                            item.className = 'workflow-item';
                            showToast(`Workflow ${workflowId} desativado!`, 'info');
                        }
                    }
                });
            }, 1000);
        }

        function editSchedule(taskId) {
            showToast(`Editando agendamento: ${taskId}`, 'info');
            
            // Simulate opening edit modal
            setTimeout(() => {
                showToast('Agendamento atualizado!', 'success');
            }, 1500);
        }

        function dismissAlert(alertId) {
            const alertItems = document.querySelectorAll('.alert-item');
            alertItems.forEach(item => {
                const button = item.querySelector('button');
                if (button && button.getAttribute('onclick').includes(alertId)) {
                    item.style.opacity = '0.5';
                    item.style.transform = 'translateX(100%)';
                    
                    setTimeout(() => {
                        item.remove();
                        showToast('Alerta removido!', 'info');
                    }, 300);
                }
            });
        }

        // Toast function
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            toastTitle.textContent = type === 'success' ? 'Sucesso' : type === 'error' ? 'Erro' : 'Informação';
            toastMessage.textContent = message;
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
    </script>
</body>
</html>