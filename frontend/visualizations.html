<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizações & Dashboards - Sistema de Gestão de Suprimentos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="css/global-styles.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    
    <style>
        .visualization-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .visualization-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .chart-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .dashboard-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .report-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .visualization-section {
            margin-bottom: 40px;
        }
        
        .section-header {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin-bottom: 25px;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .dashboard-preview {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .chart-controls {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .export-btn {
            margin: 5px;
        }
        
        .chart-type-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .chart-type-btn {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chart-type-btn:hover,
        .chart-type-btn.active {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-pie-chart"></i> Visualizações & Dashboards
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="analytics.html">
                            <i class="bi bi-graph-up-arrow"></i> Analytics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="predictions.html">
                            <i class="bi bi-crystal-ball"></i> Predições
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="visualizations.html">
                            <i class="bi bi-pie-chart"></i> Visualizações
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="automation.html">
                            <i class="bi bi-gear"></i> Automação
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5 pt-4">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1><i class="bi bi-pie-chart"></i> Visualizações & Dashboards</h1>
                <p class="text-muted">Crie e personalize dashboards e visualizações de dados</p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-lightning"></i> Ações Rápidas
                        </h5>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-primary" onclick="generateQuickDashboard()">
                                <i class="bi bi-speedometer2"></i> Dashboard Rápido
                            </button>
                            <button class="btn btn-success" onclick="exportCurrentView()">
                                <i class="bi bi-download"></i> Exportar Visualização
                            </button>
                            <button class="btn btn-info" onclick="shareVisualization()">
                                <i class="bi bi-share"></i> Compartilhar
                            </button>
                            <button class="btn btn-warning" onclick="resetVisualization()">
                                <i class="bi bi-arrow-clockwise"></i> Resetar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Visualization Tools -->
        <div class="visualization-section">
            <div class="section-header">
                <h3>Geradores de Visualização</h3>
                <p class="text-muted mb-0">Ferramentas para criar gráficos e dashboards personalizados</p>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card visualization-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-bar-chart" style="font-size: 3rem;"></i>
                            <h5 class="card-title mt-3">Gráficos Dinâmicos</h5>
                            <p class="card-text">Crie gráficos interativos com dados em tempo real</p>
                            <button class="btn btn-light" onclick="openChartBuilder()">
                                <i class="bi bi-plus-circle"></i> Criar Gráfico
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card visualization-card chart-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-speedometer2" style="font-size: 3rem;"></i>
                            <h5 class="card-title mt-3">Dashboard Personalizado</h5>
                            <p class="card-text">Monte seu próprio dashboard com widgets</p>
                            <button class="btn btn-light" onclick="openDashboardBuilder()">
                                <i class="bi bi-grid"></i> Construir Dashboard
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card visualization-card dashboard-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-file-earmark-text" style="font-size: 3rem;"></i>
                            <h5 class="card-title mt-3">Relatórios Visuais</h5>
                            <p class="card-text">Gere relatórios com gráficos e tabelas</p>
                            <button class="btn btn-light" onclick="generateVisualReport()">
                                <i class="bi bi-file-plus"></i> Gerar Relatório
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card visualization-card report-card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-map" style="font-size: 3rem;"></i>
                            <h5 class="card-title mt-3">Mapas de Calor</h5>
                            <p class="card-text">Visualize dados geográficos e de densidade</p>
                            <button class="btn btn-light" onclick="createHeatmap()">
                                <i class="bi bi-geo"></i> Criar Mapa
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart Builder -->
        <div class="chart-controls" id="chartControls" style="display: none;">
            <h5><i class="bi bi-tools"></i> Construtor de Gráficos</h5>
            
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Tipo de Gráfico</label>
                    <div class="chart-type-selector">
                        <div class="chart-type-btn active" data-type="bar">
                            <i class="bi bi-bar-chart"></i> Barras
                        </div>
                        <div class="chart-type-btn" data-type="line">
                            <i class="bi bi-graph-up"></i> Linha
                        </div>
                        <div class="chart-type-btn" data-type="pie">
                            <i class="bi bi-pie-chart"></i> Pizza
                        </div>
                        <div class="chart-type-btn" data-type="doughnut">
                            <i class="bi bi-circle"></i> Rosca
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <label class="form-label">Fonte de Dados</label>
                    <select class="form-select" id="dataSource">
                        <option value="products">Produtos</option>
                        <option value="suppliers">Fornecedores</option>
                        <option value="orders">Pedidos</option>
                        <option value="quotes">Cotações</option>
                    </select>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-6">
                    <label class="form-label">Campo X</label>
                    <select class="form-select" id="xField">
                        <option value="category">Categoria</option>
                        <option value="supplier">Fornecedor</option>
                        <option value="date">Data</option>
                        <option value="status">Status</option>
                    </select>
                </div>
                
                <div class="col-md-6">
                    <label class="form-label">Campo Y</label>
                    <select class="form-select" id="yField">
                        <option value="count">Quantidade</option>
                        <option value="value">Valor</option>
                        <option value="price">Preço</option>
                        <option value="stock">Estoque</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="generateChart()">
                    <i class="bi bi-graph-up"></i> Gerar Gráfico
                </button>
                <button class="btn btn-secondary" onclick="hideChartBuilder()">
                    <i class="bi bi-x"></i> Cancelar
                </button>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Gerando visualização...</span>
            </div>
            <p class="mt-2">Criando visualização...</p>
        </div>

        <!-- Charts Display -->
        <div class="visualization-section">
            <div class="section-header">
                <h3>Visualizações Ativas</h3>
                <p class="text-muted mb-0">Gráficos e dashboards gerados</p>
            </div>
            
            <div class="row" id="chartsContainer">
                <div class="col-md-6">
                    <div class="chart-container">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Produtos por Categoria</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-primary export-btn" onclick="exportChart('categoryChart')">
                                    <i class="bi bi-download"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary export-btn" onclick="fullscreenChart('categoryChart')">
                                    <i class="bi bi-fullscreen"></i>
                                </button>
                            </div>
                        </div>
                        <canvas id="categoryChart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="chart-container">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Vendas Mensais</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-primary export-btn" onclick="exportChart('salesChart')">
                                    <i class="bi bi-download"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary export-btn" onclick="fullscreenChart('salesChart')">
                                    <i class="bi bi-fullscreen"></i>
                                </button>
                            </div>
                        </div>
                        <canvas id="salesChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Preview -->
        <div class="dashboard-preview" id="dashboardPreview">
            <h4>Preview do Dashboard</h4>
            <div class="row">
                <div class="col-md-8">
                    <div class="chart-container">
                        <h5>Gráfico Principal</h5>
                        <canvas id="mainChart" width="600" height="300"></canvas>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="chart-container">
                        <h5>Métricas</h5>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="text-center p-3 bg-primary text-white rounded">
                                    <h3 id="metric1">150</h3>
                                    <small>Total de Produtos</small>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <div class="text-center p-3 bg-success text-white rounded">
                                    <h3 id="metric2">25</h3>
                                    <small>Fornecedores Ativos</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notificação</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Mensagem
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/global-functions.js"></script>
    <script src="js/mobile-menu.js"></script>
    
    <script>
        let currentCharts = {};
        let selectedChartType = 'bar';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeDefaultCharts();
            setupChartTypeSelectors();
        });

        // Setup chart type selectors
        function setupChartTypeSelectors() {
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedChartType = this.dataset.type;
                });
            });
        }

        // Initialize default charts
        function initializeDefaultCharts() {
            // Category Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            currentCharts.categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Eletrônicos', 'Ferramentas', 'Materiais', 'Equipamentos'],
                    datasets: [{
                        data: [30, 25, 20, 25],
                        backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Sales Chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            currentCharts.salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Vendas (R$)',
                        data: [12000, 19000, 15000, 25000, 22000, 30000],
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            }
                        }
                    }
                }
            });
        }

        // Visualization functions
        function openChartBuilder() {
            document.getElementById('chartControls').style.display = 'block';
            document.getElementById('chartControls').scrollIntoView({ behavior: 'smooth' });
        }

        function hideChartBuilder() {
            document.getElementById('chartControls').style.display = 'none';
        }

        function openDashboardBuilder() {
            const preview = document.getElementById('dashboardPreview');
            preview.style.display = 'block';
            preview.scrollIntoView({ behavior: 'smooth' });
            
            // Initialize main chart in preview
            setTimeout(() => {
                const mainCtx = document.getElementById('mainChart').getContext('2d');
                new Chart(mainCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                        datasets: [{
                            label: 'Receita',
                            data: [65000, 75000, 85000, 95000],
                            backgroundColor: '#007bff'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                }
                            }
                        }
                    }
                });
            }, 100);
            
            showToast('Dashboard personalizado carregado!', 'success');
        }

        function generateChart() {
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            try {
                loadingSpinner.style.display = 'block';
                
                // Simulate chart generation
                setTimeout(() => {
                    loadingSpinner.style.display = 'none';
                    hideChartBuilder();
                    
                    // Add new chart to container
                    addNewChart();
                    
                    showToast('Gráfico gerado com sucesso!', 'success');
                }, 2000);
                
            } catch (error) {
                loadingSpinner.style.display = 'none';
                showToast('Erro ao gerar gráfico: ' + error.message, 'error');
            }
        }

        function addNewChart() {
            const container = document.getElementById('chartsContainer');
            const chartId = 'chart_' + Date.now();
            
            const chartHtml = `
                <div class="col-md-6">
                    <div class="chart-container">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>Gráfico Personalizado</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-primary export-btn" onclick="exportChart('${chartId}')">
                                    <i class="bi bi-download"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger export-btn" onclick="removeChart('${chartId}')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        <canvas id="${chartId}" width="400" height="200"></canvas>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', chartHtml);
            
            // Initialize the new chart
            setTimeout(() => {
                const ctx = document.getElementById(chartId).getContext('2d');
                currentCharts[chartId] = new Chart(ctx, {
                    type: selectedChartType,
                    data: generateSampleData(),
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }, 100);
        }

        function generateSampleData() {
            const labels = ['Item A', 'Item B', 'Item C', 'Item D'];
            const data = labels.map(() => Math.floor(Math.random() * 100) + 10);
            
            return {
                labels: labels,
                datasets: [{
                    label: 'Dados',
                    data: data,
                    backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545']
                }]
            };
        }

        function generateVisualReport() {
            showToast('Gerando relatório visual...', 'info');
            
            setTimeout(() => {
                // Simulate report generation
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(`
                    <html>
                        <head>
                            <title>Relatório Visual</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; }
                                .header { text-align: center; margin-bottom: 30px; }
                                .chart-section { margin: 20px 0; }
                            </style>
                        </head>
                        <body>
                            <div class="header">
                                <h1>Relatório Visual - Sistema de Gestão</h1>
                                <p>Gerado em: ${new Date().toLocaleDateString('pt-BR')}</p>
                            </div>
                            <div class="chart-section">
                                <h2>Resumo Executivo</h2>
                                <p>Este relatório apresenta as principais métricas e visualizações do sistema.</p>
                            </div>
                        </body>
                    </html>
                `);
                reportWindow.document.close();
                
                showToast('Relatório visual gerado!', 'success');
            }, 1500);
        }

        function createHeatmap() {
            showToast('Funcionalidade de mapa de calor em desenvolvimento', 'info');
        }

        function generateQuickDashboard() {
            openDashboardBuilder();
        }

        function exportChart(chartId) {
            if (currentCharts[chartId]) {
                const link = document.createElement('a');
                link.download = `${chartId}.png`;
                link.href = currentCharts[chartId].toBase64Image();
                link.click();
                
                showToast('Gráfico exportado com sucesso!', 'success');
            }
        }

        function removeChart(chartId) {
            if (currentCharts[chartId]) {
                currentCharts[chartId].destroy();
                delete currentCharts[chartId];
                document.getElementById(chartId).closest('.col-md-6').remove();
                
                showToast('Gráfico removido!', 'info');
            }
        }

        function fullscreenChart(chartId) {
            showToast('Modo tela cheia em desenvolvimento', 'info');
        }

        function exportCurrentView() {
            showToast('Exportando visualização atual...', 'info');
        }

        function shareVisualization() {
            showToast('Funcionalidade de compartilhamento em desenvolvimento', 'info');
        }

        function resetVisualization() {
            // Reset all custom charts
            Object.keys(currentCharts).forEach(chartId => {
                if (chartId !== 'categoryChart' && chartId !== 'salesChart') {
                    removeChart(chartId);
                }
            });
            
            // Hide dashboard preview
            document.getElementById('dashboardPreview').style.display = 'none';
            hideChartBuilder();
            
            showToast('Visualizações resetadas!', 'info');
        }

        // Toast function
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            toastTitle.textContent = type === 'success' ? 'Sucesso' : type === 'error' ? 'Erro' : 'Informação';
            toastMessage.textContent = message;
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }
    </script>
</body>
</html>